C51 COMPILER V9.00   MAIN                                                                  06/14/2020 22:14:08 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) OBJECT(.\
                    -Objects\main.obj)

line level    source

   1          #include "STC8.H"
   2          #include "pll.h"
   3          #include "hw.h"
   4          #include "adc.h"
   5          #include "rtx.h"
   6          #include "cmd.h"
   7          #include "utily.h"
   8          
   9          //WARNNING:STC MCU int protype is 16 bit width,not 32 bit width！！！！！！
  10          
  11          unsigned char msg[5];
  12          unsigned char len;
  13          
  14          void GetPowerVoltage()
  15          {
  16   1              unsigned int var=0;
  17   1              unsigned char idx = 0;
  18   1      
  19   1              for(;idx<10;idx++)
  20   1                      var += ADC_Get(ADC_CH_P1_1);
  21   1      
  22   1              var /= 10;
  23   1      
  24   1              msg[0] = PLL_GetATT(var);
  25   1      
  26   1              len = 1;
  27   1      
  28   1              RTX_SendBytes(msg,len); 
  29   1      }
  30          
  31          void GetPLLLockSta()
  32          {
  33   1              if(PLL_IsLocked() == 1)
  34   1                      msg[0] =  0;
  35   1              else  msg[0] =  1;
  36   1              len = 1;
  37   1              RTX_SendBytes(msg,len);
  38   1      }
  39          
  40          int main()
  41          {
  42   1              unsigned char cmd;
  43   1                                        
  44   1              //config sysclk
  45   1              HW_SysclkInit();
  46   1      
  47   1              //config pins
  48   1              HW_IOInit();
  49   1      
  50   1              //config perhaps
  51   1              HW_T2Init();
  52   1              HW_IntcInit();
  53   1              RTX_Init();
  54   1              ADC_Init();
C51 COMPILER V9.00   MAIN                                                                  06/14/2020 22:14:08 PAGE 2   

  55   1      
  56   1              delay_ms(500);
  57   1      
  58   1              //config dds
  59   1              PLL_Reset();
  60   1              PLL_Config();
  61   1      
  62   1              while(1)
  63   1              {
  64   2                      if(Cmd_IsNew())
  65   2                      {
  66   3                              Cmd_get(&cmd);
  67   3                              switch(cmd)
  68   3                              {
  69   4                                      case 0x00://发射功率：0-正功率值，1-负功率值
  70   4                                              GetPowerVoltage();
  71   4                                              break;
  72   4                                      case 0x01://本振锁定指示
  73   4                                              GetPLLLockSta();
  74   4                                              break;
  75   4                                      case 0x02://以上所有参数
  76   4                                              GetPowerVoltage();
  77   4                                              GetPLLLockSta();
  78   4                                              break;
  79   4                                      case 0x03:
  80   4                                              PLL_TxEn(1);
  81   4                                              break;
  82   4                                      case 0x04:
  83   4                                              PLL_TxEn(0);
  84   4                                              break;
  85   4                                      default:
  86   4                                              break;
  87   4                              }
  88   3                      }
  89   2              }
  90   1      }
  91          
  92          
  93          
  94          
  95          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    213    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
