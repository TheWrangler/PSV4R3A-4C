C51 COMPILER V9.00   MAIN                                                                  06/14/2020 19:21:02 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) OBJECT(.\Object
                    -s\main.obj)

line level    source

   1          #include "STC8.H"
   2          #include "pll.h"
   3          #include "hw.h"
   4          #include "adc.h"
   5          #include "rtx.h"
   6          #include "cmd.h"
   7          #include "utily.h"
   8          
   9          //WARNNING:STC MCU int protype is 16 bit width,not 32 bit width！！！！！！
  10          
  11          unsigned char msg[5];
  12          unsigned char len;
  13          
  14          void GetPowerVoltage()
  15          {
  16   1              unsigned int var;
  17   1              var = ADC_Get(ADC_CH_P1_1);
  18   1              msg[0] = var >> 8;
  19   1              msg[1] = var;
  20   1              len = 2;
  21   1              RTX_SendBytes(msg,len); 
  22   1      }
  23          
  24          void GetPLLLockSta()
  25          {
  26   1              if(PLL_IsLocked() == 1)
  27   1                      msg[0] =  0;
  28   1              else  msg[0] =  1;
  29   1              len = 1;
  30   1              RTX_SendBytes(msg,len);
  31   1      }
  32          
  33          int main()
  34          {
  35   1              unsigned char cmd;
  36   1                                        
  37   1              //config sysclk
  38   1              HW_SysclkInit();
  39   1      
  40   1              //config pins
  41   1              HW_IOInit();
  42   1      
  43   1              //config perhaps
  44   1              HW_T2Init();
  45   1              HW_IntcInit();
  46   1              RTX_Init();
  47   1              ADC_Init();
  48   1      
  49   1              delay_ms(500);
  50   1      
  51   1              //config dds
  52   1              PLL_Reset();
  53   1              PLL_Config();
  54   1      
C51 COMPILER V9.00   MAIN                                                                  06/14/2020 19:21:02 PAGE 2   

  55   1              while(1)
  56   1              {
  57   2                      if(Cmd_IsNew())
  58   2                      {
  59   3                              Cmd_get(&cmd);
  60   3                              switch(cmd)
  61   3                              {
  62   4                                      case 0x00://发射功率：0-正功率值，1-负功率值
  63   4                                              GetPowerVoltage();
  64   4                                              break;
  65   4                                      case 0x01://本振锁定指示
  66   4                                              GetPLLLockSta();
  67   4                                              break;
  68   4                                      case 0x02://以上所有参数
  69   4                                              GetPowerVoltage();
  70   4                                              GetPLLLockSta();
  71   4                                              break;
  72   4                                      case 0x03:
  73   4                                              PLL_TxEn(1);
  74   4                                              break;
  75   4                                      case 0x04:
  76   4                                              PLL_TxEn(0);
  77   4                                              break;
  78   4                                      default:
  79   4                                              break;
  80   4                              }
  81   3                      }
  82   2              }
  83   1      }
  84          
  85          
  86          
  87          
  88          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    148    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
