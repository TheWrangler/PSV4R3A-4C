C51 COMPILER V9.00   MAIN                                                                  10/31/2019 17:55:17 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) OBJECT(.\Object
                    -s\main.obj)

line level    source

   1          #include "STC8.H"
   2          #include "pll.h"
   3          #include "hw.h"
   4          #include "adc.h"
   5          #include "rtx.h"
   6          #include "cmd.h"
   7          #include "utily.h"
   8          
   9          //WARNNING:STC MCU int protype is 16 bit width,not 32 bit width！！！！！！
  10          
  11          unsigned char msg[25];
  12          
  13          unsigned char _sprintf_pllwait(unsigned char* buf)
  14          {
  15   1              buf[0] = 'w';
  16   1              buf[1] = 'a';
  17   1              buf[2] = 'i';
  18   1              buf[3] = 't';
  19   1              buf[4] = ' ';
  20   1              buf[5] = 'f';
  21   1              buf[6] = 'o';
  22   1              buf[7] = 'r';
  23   1              buf[8] = ' ';
  24   1              buf[9] = 'F';
  25   1              buf[10] = 'S';
  26   1              buf[11] = ' ';
  27   1              buf[12] = 'l';
  28   1              buf[13] = 'o';
  29   1              buf[14] = 'c';
  30   1              buf[15] = 'k';
  31   1              buf[16] = 'e';
  32   1              buf[17] = 'd';
  33   1              buf[18] = '.';
  34   1              buf[19] = '.';
  35   1              buf[20] = '.';
  36   1              buf[21] = '\n';
  37   1      
  38   1              return 22;
  39   1      }
  40          
  41          unsigned char _sprintf_char(unsigned char* buf,unsigned char var)
  42          {
  43   1              unsigned char temp = var / 100;
  44   1              buf[0] = temp + 0x30;
  45   1      
  46   1              var -= temp * 100;
  47   1      
  48   1              temp = var / 10;
  49   1              buf[1] = temp + 0x30;
  50   1      
  51   1              var -= temp * 10;
  52   1      
  53   1              buf[2] = var + 0x30;
  54   1      
C51 COMPILER V9.00   MAIN                                                                  10/31/2019 17:55:17 PAGE 2   

  55   1              buf[3] = '\n';
  56   1      
  57   1              return 4;
  58   1      }
  59          
  60          unsigned char _sprintf_word(unsigned char* buf,unsigned int var)
  61          {
  62   1              unsigned char temp = (var & 0xff00) >> 8;
  63   1              unsigned char len = _sprintf_char(buf,temp);
  64   1              len -= 1;
  65   1      
  66   1              temp = (var & 0x00ff);
  67   1              len += _sprintf_char(buf+len,temp);
  68   1      
  69   1              return len;
  70   1      }
  71          
  72          int main()
  73          {
  74   1              unsigned char cmd,len;
  75   1              unsigned int var;
  76   1      
  77   1              //config sysclk
  78   1              HW_SysclkInit();
  79   1      
  80   1              //config pins
  81   1              HW_IOInit();
  82   1      
  83   1              //config perhaps
  84   1              HW_T2Init();
  85   1              HW_IntcInit();
  86   1              RTX_Init();
  87   1              ADC_Init();
  88   1      
  89   1              delay_ms(1000);
  90   1      
  91   1              len = _sprintf_pllwait(msg);
  92   1      
  93   1              //config dds
  94   1              PLL_Reset();
  95   1              PLL_Config();
  96   1              RTX_SendBytes(msg,len);
  97   1              delay_ms(500);
  98   1      
  99   1              while(PLL_IsLocked() != 1)
 100   1              {
 101   2                      PLL_Reset();
 102   2                      PLL_Config();
 103   2                      RTX_SendBytes(msg,len);
 104   2                      delay_ms(500);
 105   2              }
 106   1              
 107   1              while(1)
 108   1              {
 109   2                      if(Cmd_IsNew())
 110   2                      {
 111   3                              Cmd_get(&cmd);
 112   3                              switch(cmd)
 113   3                              {
 114   4                                      case 0x00://发射功率：0-正功率值，1-负功率值
 115   4                                              var = ADC_Get(ADC_CH_P1_0);
 116   4                                              len = _sprintf_word(msg,var);
C51 COMPILER V9.00   MAIN                                                                  10/31/2019 17:55:17 PAGE 3   

 117   4                                              RTX_SendBytes(msg,len);
 118   4                                              break;
 119   4                                      case 0x01://本振锁定指示
 120   4                                              break;
 121   4                                      case 0x02://以上所有参数
 122   4                                              break;
 123   4                                      case 0x03:
 124   4                                              break;
 125   4                                      default:
 126   4                                              break;
 127   4                              }
 128   3                      }
 129   2              }
 130   1      }
 131          
 132          
 133          
 134          
 135          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    409    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     25       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
